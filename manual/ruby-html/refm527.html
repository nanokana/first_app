<?xml version="1.0" encoding="EUC-JP" ?>
<!DOCTYPE html 
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>ruby-src:lib/time.rb</title>
<meta http-equiv="Content-type" content="text/html; charset=EUC-JP" />
<link href="default.css" type="text/css" rel="stylesheet" />
<link href="refm528.html" rel="next" />
<link href="refm526.html" rel="prev" />
<link href="index.html" rel="start" />

</head>
<body>
<div class="navigator"><span class="navigator">[<a href="index.html">MAIN</a>][<a href="refm539.html">INDEX</a>]&nbsp;&nbsp;&nbsp;[<a href="index.html">TOP</a>][<a href="index.html">UP</a>][<a href="refm526.html">&lt;-PREV</a>][<a href="refm528.html">NEXT-&gt;</a>]</span></div>
<hr />

<h1>ruby-src:lib/time.rb</h1>
<br />
#<br />
#&nbsp;==&nbsp;Introduction<br />
#&nbsp;<br />
#&nbsp;This&nbsp;library&nbsp;extends&nbsp;the&nbsp;Time&nbsp;class:<br />
#&nbsp;*&nbsp;conversion&nbsp;between&nbsp;date&nbsp;string&nbsp;and&nbsp;time&nbsp;object.<br />
#&nbsp;&nbsp;&nbsp;*&nbsp;date-time&nbsp;defined&nbsp;by&nbsp;RFC&nbsp;2822<br />
#&nbsp;&nbsp;&nbsp;*&nbsp;HTTP-date&nbsp;defined&nbsp;by&nbsp;RFC&nbsp;2616<br />
#&nbsp;&nbsp;&nbsp;*&nbsp;dateTime&nbsp;defined&nbsp;by&nbsp;XML&nbsp;Schema&nbsp;Part&nbsp;2:&nbsp;Datatypes&nbsp;(ISO&nbsp;8601)<br />
#&nbsp;&nbsp;&nbsp;*&nbsp;various&nbsp;formats&nbsp;handled&nbsp;by&nbsp;Date._parse&nbsp;(string&nbsp;to&nbsp;time&nbsp;only)<br />
#&nbsp;<br />
#&nbsp;==&nbsp;Design&nbsp;Issues<br />
#&nbsp;<br />
#&nbsp;===&nbsp;Specialized&nbsp;interface<br />
#&nbsp;<br />
#&nbsp;This&nbsp;library&nbsp;provides&nbsp;methods&nbsp;dedicated&nbsp;to&nbsp;special&nbsp;purposes:<br />
#&nbsp;*&nbsp;RFC&nbsp;2822,&nbsp;RFC&nbsp;2616&nbsp;and&nbsp;XML&nbsp;Schema.<br />
#&nbsp;*&nbsp;They&nbsp;makes&nbsp;usual&nbsp;life&nbsp;easier.<br />
#&nbsp;<br />
#&nbsp;===&nbsp;Doesn't&nbsp;depend&nbsp;on&nbsp;strftime<br />
#&nbsp;<br />
#&nbsp;This&nbsp;library&nbsp;doesn't&nbsp;use&nbsp;+strftime+.&nbsp;&nbsp;Especially&nbsp;#rfc2822&nbsp;doesn't&nbsp;depend<br />
#&nbsp;on&nbsp;+strftime+&nbsp;because:<br />
#&nbsp;<br />
#&nbsp;*&nbsp;%a&nbsp;and&nbsp;%b&nbsp;are&nbsp;locale&nbsp;sensitive<br />
#&nbsp;<br />
#&nbsp;&nbsp;&nbsp;Since&nbsp;they&nbsp;are&nbsp;locale&nbsp;sensitive,&nbsp;they&nbsp;may&nbsp;be&nbsp;replaced&nbsp;to<br />
#&nbsp;&nbsp;&nbsp;invalid&nbsp;weekday/month&nbsp;name&nbsp;in&nbsp;some&nbsp;locales.<br />
#&nbsp;&nbsp;&nbsp;Since&nbsp;ruby-1.6&nbsp;doesn't&nbsp;invoke&nbsp;setlocale&nbsp;by&nbsp;default,<br />
#&nbsp;&nbsp;&nbsp;the&nbsp;problem&nbsp;doesn't&nbsp;arise&nbsp;until&nbsp;some&nbsp;external&nbsp;library&nbsp;invokes&nbsp;setlocale.<br />
#&nbsp;&nbsp;&nbsp;Ruby/GTK&nbsp;is&nbsp;the&nbsp;example&nbsp;of&nbsp;such&nbsp;library.<br />
#&nbsp;<br />
#&nbsp;*&nbsp;%z&nbsp;is&nbsp;not&nbsp;portable<br />
#&nbsp;<br />
#&nbsp;&nbsp;&nbsp;%z&nbsp;is&nbsp;required&nbsp;to&nbsp;generate&nbsp;zone&nbsp;in&nbsp;date-time&nbsp;of&nbsp;RFC&nbsp;2822<br />
#&nbsp;&nbsp;&nbsp;but&nbsp;it&nbsp;is&nbsp;not&nbsp;portable.<br />
#<br />
#&nbsp;==&nbsp;Revision&nbsp;Information<br />
#<br />
#&nbsp;$Id$<br />
#<br />
<br />
require&nbsp;'date/format'<br />
<br />
#<br />
#&nbsp;Implements&nbsp;the&nbsp;extensions&nbsp;to&nbsp;the&nbsp;Time&nbsp;class&nbsp;that&nbsp;are&nbsp;described&nbsp;in&nbsp;the<br />
#&nbsp;documentation&nbsp;for&nbsp;the&nbsp;time.rb&nbsp;library.<br />
#<br />
class&nbsp;Time<br />
&nbsp;&nbsp;class&nbsp;&lt;&lt;&nbsp;Time<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;ZoneOffset&nbsp;=&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'UTC'&nbsp;=&gt;&nbsp;0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;ISO&nbsp;8601<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'Z'&nbsp;=&gt;&nbsp;0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;RFC&nbsp;822<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'UT'&nbsp;=&gt;&nbsp;0,&nbsp;'GMT'&nbsp;=&gt;&nbsp;0,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'EST'&nbsp;=&gt;&nbsp;-5,&nbsp;'EDT'&nbsp;=&gt;&nbsp;-4,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'CST'&nbsp;=&gt;&nbsp;-6,&nbsp;'CDT'&nbsp;=&gt;&nbsp;-5,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'MST'&nbsp;=&gt;&nbsp;-7,&nbsp;'MDT'&nbsp;=&gt;&nbsp;-6,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'PST'&nbsp;=&gt;&nbsp;-8,&nbsp;'PDT'&nbsp;=&gt;&nbsp;-7,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Following&nbsp;definition&nbsp;of&nbsp;military&nbsp;zones&nbsp;is&nbsp;original&nbsp;one.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;See&nbsp;RFC&nbsp;1123&nbsp;and&nbsp;RFC&nbsp;2822&nbsp;for&nbsp;the&nbsp;error&nbsp;in&nbsp;RFC&nbsp;822.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'A'&nbsp;=&gt;&nbsp;+1,&nbsp;'B'&nbsp;=&gt;&nbsp;+2,&nbsp;'C'&nbsp;=&gt;&nbsp;+3,&nbsp;'D'&nbsp;=&gt;&nbsp;+4,&nbsp;&nbsp;'E'&nbsp;=&gt;&nbsp;+5,&nbsp;&nbsp;'F'&nbsp;=&gt;&nbsp;+6,&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'G'&nbsp;=&gt;&nbsp;+7,&nbsp;'H'&nbsp;=&gt;&nbsp;+8,&nbsp;'I'&nbsp;=&gt;&nbsp;+9,&nbsp;'K'&nbsp;=&gt;&nbsp;+10,&nbsp;'L'&nbsp;=&gt;&nbsp;+11,&nbsp;'M'&nbsp;=&gt;&nbsp;+12,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'N'&nbsp;=&gt;&nbsp;-1,&nbsp;'O'&nbsp;=&gt;&nbsp;-2,&nbsp;'P'&nbsp;=&gt;&nbsp;-3,&nbsp;'Q'&nbsp;=&gt;&nbsp;-4,&nbsp;&nbsp;'R'&nbsp;=&gt;&nbsp;-5,&nbsp;&nbsp;'S'&nbsp;=&gt;&nbsp;-6,&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'T'&nbsp;=&gt;&nbsp;-7,&nbsp;'U'&nbsp;=&gt;&nbsp;-8,&nbsp;'V'&nbsp;=&gt;&nbsp;-9,&nbsp;'W'&nbsp;=&gt;&nbsp;-10,&nbsp;'X'&nbsp;=&gt;&nbsp;-11,&nbsp;'Y'&nbsp;=&gt;&nbsp;-12,<br />
&nbsp;&nbsp;&nbsp;&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;zone_offset(zone,&nbsp;year=Time.now.year)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;off&nbsp;=&nbsp;nil<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zone&nbsp;=&nbsp;zone.upcase<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;/\A([+-])(\d\d):?(\d\d)\z/&nbsp;=~&nbsp;zone<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;off&nbsp;=&nbsp;($1&nbsp;==&nbsp;'-'&nbsp;?&nbsp;-1&nbsp;:&nbsp;1)&nbsp;*&nbsp;($2.to_i&nbsp;*&nbsp;60&nbsp;+&nbsp;$3.to_i)&nbsp;*&nbsp;60<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elsif&nbsp;/\A[+-]\d\d\z/&nbsp;=~&nbsp;zone<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;off&nbsp;=&nbsp;zone.to_i&nbsp;*&nbsp;3600<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elsif&nbsp;ZoneOffset.include?(zone)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;off&nbsp;=&nbsp;ZoneOffset[zone]&nbsp;*&nbsp;3600<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elsif&nbsp;((t&nbsp;=&nbsp;Time.local(year,&nbsp;1,&nbsp;1)).zone.upcase&nbsp;==&nbsp;zone&nbsp;rescue&nbsp;false)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;off&nbsp;=&nbsp;t.utc_offset<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elsif&nbsp;((t&nbsp;=&nbsp;Time.local(year,&nbsp;7,&nbsp;1)).zone.upcase&nbsp;==&nbsp;zone&nbsp;rescue&nbsp;false)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;off&nbsp;=&nbsp;t.utc_offset<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;off<br />
&nbsp;&nbsp;&nbsp;&nbsp;end<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;zone_utc?(zone)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;*&nbsp;+0000&nbsp;means&nbsp;localtime.&nbsp;[RFC&nbsp;2822]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;*&nbsp;GMT&nbsp;is&nbsp;a&nbsp;localtime&nbsp;abbreviation&nbsp;in&nbsp;Europe/London,&nbsp;etc.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;/\A(?:-00:00|-0000|-00|UTC|Z|UT)\z/i&nbsp;=~&nbsp;zone<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;true<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;false<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<br />
&nbsp;&nbsp;&nbsp;&nbsp;end<br />
&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;:zone_utc?<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;LeapYearMonthDays&nbsp;=&nbsp;[31,&nbsp;29,&nbsp;31,&nbsp;30,&nbsp;31,&nbsp;30,&nbsp;31,&nbsp;31,&nbsp;30,&nbsp;31,&nbsp;30,&nbsp;31]<br />
&nbsp;&nbsp;&nbsp;&nbsp;CommonYearMonthDays&nbsp;=&nbsp;[31,&nbsp;28,&nbsp;31,&nbsp;30,&nbsp;31,&nbsp;30,&nbsp;31,&nbsp;31,&nbsp;30,&nbsp;31,&nbsp;30,&nbsp;31]<br />
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;month_days(y,&nbsp;m)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((y&nbsp;%&nbsp;4&nbsp;==&nbsp;0)&nbsp;&amp;&amp;&nbsp;(y&nbsp;%&nbsp;100&nbsp;!=&nbsp;0))&nbsp;||&nbsp;(y&nbsp;%&nbsp;400&nbsp;==&nbsp;0)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LeapYearMonthDays[m-1]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CommonYearMonthDays[m-1]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<br />
&nbsp;&nbsp;&nbsp;&nbsp;end<br />
&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;:month_days<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;apply_offset(year,&nbsp;mon,&nbsp;day,&nbsp;hour,&nbsp;min,&nbsp;sec,&nbsp;off)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;off&nbsp;&lt;&nbsp;0<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;off&nbsp;=&nbsp;-off<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;off,&nbsp;o&nbsp;=&nbsp;off.divmod(60)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;o&nbsp;!=&nbsp;0&nbsp;then&nbsp;sec&nbsp;+=&nbsp;o;&nbsp;o,&nbsp;sec&nbsp;=&nbsp;sec.divmod(60);&nbsp;off&nbsp;+=&nbsp;o&nbsp;end<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;off,&nbsp;o&nbsp;=&nbsp;off.divmod(60)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;o&nbsp;!=&nbsp;0&nbsp;then&nbsp;min&nbsp;+=&nbsp;o;&nbsp;o,&nbsp;min&nbsp;=&nbsp;min.divmod(60);&nbsp;off&nbsp;+=&nbsp;o&nbsp;end<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;off,&nbsp;o&nbsp;=&nbsp;off.divmod(24)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;o&nbsp;!=&nbsp;0&nbsp;then&nbsp;hour&nbsp;+=&nbsp;o;&nbsp;o,&nbsp;hour&nbsp;=&nbsp;hour.divmod(24);&nbsp;off&nbsp;+=&nbsp;o&nbsp;end<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;off&nbsp;!=&nbsp;0<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;day&nbsp;+=&nbsp;off<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;month_days(year,&nbsp;mon)&nbsp;&lt;&nbsp;day<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mon&nbsp;+=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;12&nbsp;&lt;&nbsp;mon<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mon&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;year&nbsp;+=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;day&nbsp;=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elsif&nbsp;0&nbsp;&lt;&nbsp;off<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;off,&nbsp;o&nbsp;=&nbsp;off.divmod(60)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;o&nbsp;!=&nbsp;0&nbsp;then&nbsp;sec&nbsp;-=&nbsp;o;&nbsp;o,&nbsp;sec&nbsp;=&nbsp;sec.divmod(60);&nbsp;off&nbsp;-=&nbsp;o&nbsp;end<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;off,&nbsp;o&nbsp;=&nbsp;off.divmod(60)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;o&nbsp;!=&nbsp;0&nbsp;then&nbsp;min&nbsp;-=&nbsp;o;&nbsp;o,&nbsp;min&nbsp;=&nbsp;min.divmod(60);&nbsp;off&nbsp;-=&nbsp;o&nbsp;end<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;off,&nbsp;o&nbsp;=&nbsp;off.divmod(24)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;o&nbsp;!=&nbsp;0&nbsp;then&nbsp;hour&nbsp;-=&nbsp;o;&nbsp;o,&nbsp;hour&nbsp;=&nbsp;hour.divmod(24);&nbsp;off&nbsp;-=&nbsp;o&nbsp;end<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;off&nbsp;!=&nbsp;0&nbsp;then<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;day&nbsp;-=&nbsp;off<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;day&nbsp;&lt;&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mon&nbsp;-=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;mon&nbsp;&lt;&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;year&nbsp;-=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mon&nbsp;=&nbsp;12<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;day&nbsp;=&nbsp;month_days(year,&nbsp;mon)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;year,&nbsp;mon,&nbsp;day,&nbsp;hour,&nbsp;min,&nbsp;sec<br />
&nbsp;&nbsp;&nbsp;&nbsp;end<br />
&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;:apply_offset<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;make_time(year,&nbsp;mon,&nbsp;day,&nbsp;hour,&nbsp;min,&nbsp;sec,&nbsp;sec_fraction,&nbsp;zone,&nbsp;now)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;usec&nbsp;=&nbsp;nil<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;usec&nbsp;=&nbsp;(sec_fraction&nbsp;*&nbsp;1000000).to_i&nbsp;if&nbsp;sec_fraction<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;now<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;begin<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break&nbsp;if&nbsp;year;&nbsp;year&nbsp;=&nbsp;now.year<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break&nbsp;if&nbsp;mon;&nbsp;mon&nbsp;=&nbsp;now.mon<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break&nbsp;if&nbsp;day;&nbsp;day&nbsp;=&nbsp;now.day<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break&nbsp;if&nbsp;hour;&nbsp;hour&nbsp;=&nbsp;now.hour<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break&nbsp;if&nbsp;min;&nbsp;min&nbsp;=&nbsp;now.min<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break&nbsp;if&nbsp;sec;&nbsp;sec&nbsp;=&nbsp;now.sec<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break&nbsp;if&nbsp;sec_fraction;&nbsp;usec&nbsp;=&nbsp;now.tv_usec<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end&nbsp;until&nbsp;true<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;year&nbsp;||=&nbsp;1970<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mon&nbsp;||=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;day&nbsp;||=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hour&nbsp;||=&nbsp;0<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;min&nbsp;||=&nbsp;0<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sec&nbsp;||=&nbsp;0<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;usec&nbsp;||=&nbsp;0<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;off&nbsp;=&nbsp;nil<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;off&nbsp;=&nbsp;zone_offset(zone,&nbsp;year)&nbsp;if&nbsp;zone<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;off<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;year,&nbsp;mon,&nbsp;day,&nbsp;hour,&nbsp;min,&nbsp;sec&nbsp;=<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;apply_offset(year,&nbsp;mon,&nbsp;day,&nbsp;hour,&nbsp;min,&nbsp;sec,&nbsp;off)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t&nbsp;=&nbsp;Time.utc(year,&nbsp;mon,&nbsp;day,&nbsp;hour,&nbsp;min,&nbsp;sec,&nbsp;usec)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.localtime&nbsp;if&nbsp;!zone_utc?(zone)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.local(year,&nbsp;mon,&nbsp;day,&nbsp;hour,&nbsp;min,&nbsp;sec,&nbsp;usec)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<br />
&nbsp;&nbsp;&nbsp;&nbsp;end<br />
&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;:make_time<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;#<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Parses&nbsp;+date+&nbsp;using&nbsp;Date._parse&nbsp;and&nbsp;converts&nbsp;it&nbsp;to&nbsp;a&nbsp;Time&nbsp;object.<br />
&nbsp;&nbsp;&nbsp;&nbsp;#<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;If&nbsp;a&nbsp;block&nbsp;is&nbsp;given,&nbsp;the&nbsp;year&nbsp;described&nbsp;in&nbsp;+date+&nbsp;is&nbsp;converted&nbsp;by&nbsp;the<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;block.&nbsp;&nbsp;For&nbsp;example:<br />
&nbsp;&nbsp;&nbsp;&nbsp;#<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.parse(...)&nbsp;{|y|&nbsp;y&nbsp;&lt;&nbsp;100&nbsp;?&nbsp;(y&nbsp;&gt;=&nbsp;69&nbsp;?&nbsp;y&nbsp;+&nbsp;1900&nbsp;:&nbsp;y&nbsp;+&nbsp;2000)&nbsp;:&nbsp;y}<br />
&nbsp;&nbsp;&nbsp;&nbsp;#<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;If&nbsp;the&nbsp;upper&nbsp;components&nbsp;of&nbsp;the&nbsp;given&nbsp;time&nbsp;are&nbsp;broken&nbsp;or&nbsp;missing,&nbsp;they&nbsp;are<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;supplied&nbsp;with&nbsp;those&nbsp;of&nbsp;+now+.&nbsp;&nbsp;For&nbsp;the&nbsp;lower&nbsp;components,&nbsp;the&nbsp;minimum<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;values&nbsp;(1&nbsp;or&nbsp;0)&nbsp;are&nbsp;assumed&nbsp;if&nbsp;broken&nbsp;or&nbsp;missing.&nbsp;&nbsp;For&nbsp;example:<br />
&nbsp;&nbsp;&nbsp;&nbsp;#<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Suppose&nbsp;it&nbsp;is&nbsp;&quot;Thu&nbsp;Nov&nbsp;29&nbsp;14:33:20&nbsp;GMT&nbsp;2001&quot;&nbsp;now&nbsp;and<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;your&nbsp;timezone&nbsp;is&nbsp;GMT:<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.parse(&quot;16:30&quot;)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#=&gt;&nbsp;Thu&nbsp;Nov&nbsp;29&nbsp;16:30:00&nbsp;GMT&nbsp;2001<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.parse(&quot;7/23&quot;)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#=&gt;&nbsp;Mon&nbsp;Jul&nbsp;23&nbsp;00:00:00&nbsp;GMT&nbsp;2001<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.parse(&quot;Aug&nbsp;31&quot;)&nbsp;&nbsp;&nbsp;&nbsp;#=&gt;&nbsp;Fri&nbsp;Aug&nbsp;31&nbsp;00:00:00&nbsp;GMT&nbsp;2001<br />
&nbsp;&nbsp;&nbsp;&nbsp;#<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Since&nbsp;there&nbsp;are&nbsp;numerous&nbsp;conflicts&nbsp;among&nbsp;locally&nbsp;defined&nbsp;timezone<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;abbreviations&nbsp;all&nbsp;over&nbsp;the&nbsp;world,&nbsp;this&nbsp;method&nbsp;is&nbsp;not&nbsp;made&nbsp;to<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;understand&nbsp;all&nbsp;of&nbsp;them.&nbsp;&nbsp;For&nbsp;example,&nbsp;the&nbsp;abbreviation&nbsp;&quot;CST&quot;&nbsp;is<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;used&nbsp;variously&nbsp;as:<br />
&nbsp;&nbsp;&nbsp;&nbsp;#<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-06:00&nbsp;in&nbsp;America/Chicago,<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-05:00&nbsp;in&nbsp;America/Havana,<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+08:00&nbsp;in&nbsp;Asia/Harbin,<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+09:30&nbsp;in&nbsp;Australia/Darwin,<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+10:30&nbsp;in&nbsp;Australia/Adelaide,<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;etc.<br />
&nbsp;&nbsp;&nbsp;&nbsp;#<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Based&nbsp;on&nbsp;the&nbsp;fact,&nbsp;this&nbsp;method&nbsp;only&nbsp;understands&nbsp;the&nbsp;timezone<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;abbreviations&nbsp;described&nbsp;in&nbsp;RFC&nbsp;822&nbsp;and&nbsp;the&nbsp;system&nbsp;timezone,&nbsp;in&nbsp;the<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;order&nbsp;named.&nbsp;(i.e.&nbsp;a&nbsp;definition&nbsp;in&nbsp;RFC&nbsp;822&nbsp;overrides&nbsp;the&nbsp;system<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;timezone&nbsp;definition.)&nbsp;&nbsp;The&nbsp;system&nbsp;timezone&nbsp;is&nbsp;taken&nbsp;from<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&lt;tt&gt;Time.local(year,&nbsp;1,&nbsp;1).zone&lt;/tt&gt;&nbsp;and<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&lt;tt&gt;Time.local(year,&nbsp;7,&nbsp;1).zone&lt;/tt&gt;.<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;If&nbsp;the&nbsp;extracted&nbsp;timezone&nbsp;abbreviation&nbsp;does&nbsp;not&nbsp;match&nbsp;any&nbsp;of&nbsp;them,<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;it&nbsp;is&nbsp;ignored&nbsp;and&nbsp;the&nbsp;given&nbsp;time&nbsp;is&nbsp;regarded&nbsp;as&nbsp;a&nbsp;local&nbsp;time.<br />
&nbsp;&nbsp;&nbsp;&nbsp;#<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;ArgumentError&nbsp;is&nbsp;raised&nbsp;if&nbsp;Date._parse&nbsp;cannot&nbsp;extract&nbsp;information&nbsp;from<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;+date+&nbsp;or&nbsp;Time&nbsp;class&nbsp;cannot&nbsp;represent&nbsp;specified&nbsp;date.<br />
&nbsp;&nbsp;&nbsp;&nbsp;#<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;This&nbsp;method&nbsp;can&nbsp;be&nbsp;used&nbsp;as&nbsp;fail-safe&nbsp;for&nbsp;other&nbsp;parsing&nbsp;methods&nbsp;as:<br />
&nbsp;&nbsp;&nbsp;&nbsp;#<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;Time.rfc2822(date)&nbsp;rescue&nbsp;Time.parse(date)<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;Time.httpdate(date)&nbsp;rescue&nbsp;Time.parse(date)<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;Time.xmlschema(date)&nbsp;rescue&nbsp;Time.parse(date)<br />
&nbsp;&nbsp;&nbsp;&nbsp;#<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;A&nbsp;failure&nbsp;for&nbsp;Time.parse&nbsp;should&nbsp;be&nbsp;checked,&nbsp;though.<br />
&nbsp;&nbsp;&nbsp;&nbsp;#<br />
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;parse(date,&nbsp;now=Time.now)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d&nbsp;=&nbsp;Date._parse(date,&nbsp;false)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;year&nbsp;=&nbsp;d[:year]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;year&nbsp;=&nbsp;yield(year)&nbsp;if&nbsp;year&nbsp;&amp;&amp;&nbsp;block_given?<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;make_time(year,&nbsp;d[:mon],&nbsp;d[:mday],&nbsp;d[:hour],&nbsp;d[:min],&nbsp;d[:sec],&nbsp;d[:sec_fraction],&nbsp;d[:zone],&nbsp;now)<br />
&nbsp;&nbsp;&nbsp;&nbsp;end<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;#<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Parses&nbsp;+date+&nbsp;using&nbsp;Date._strptime&nbsp;and&nbsp;converts&nbsp;it&nbsp;to&nbsp;a&nbsp;Time&nbsp;object.<br />
&nbsp;&nbsp;&nbsp;&nbsp;#<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;If&nbsp;a&nbsp;block&nbsp;is&nbsp;given,&nbsp;the&nbsp;year&nbsp;described&nbsp;in&nbsp;+date+&nbsp;is&nbsp;converted&nbsp;by&nbsp;the<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;block.&nbsp;&nbsp;For&nbsp;example:<br />
&nbsp;&nbsp;&nbsp;&nbsp;#<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.strptime(...)&nbsp;{|y|&nbsp;y&nbsp;&lt;&nbsp;100&nbsp;?&nbsp;(y&nbsp;&gt;=&nbsp;69&nbsp;?&nbsp;y&nbsp;+&nbsp;1900&nbsp;:&nbsp;y&nbsp;+&nbsp;2000)&nbsp;:&nbsp;y}<br />
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;strptime(date,&nbsp;format,&nbsp;now=Time.now)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d&nbsp;=&nbsp;Date._strptime(date,&nbsp;format)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raise&nbsp;ArgumentError,&nbsp;&quot;invalid&nbsp;strptime&nbsp;format&nbsp;-&nbsp;`#{format}'&quot;&nbsp;unless&nbsp;d<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;year&nbsp;=&nbsp;d[:year]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;year&nbsp;=&nbsp;yield(year)&nbsp;if&nbsp;year&nbsp;&amp;&amp;&nbsp;block_given?<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;make_time(year,&nbsp;d[:mon],&nbsp;d[:mday],&nbsp;d[:hour],&nbsp;d[:min],&nbsp;d[:sec],&nbsp;d[:sec_fraction],&nbsp;d[:zone],&nbsp;now)<br />
&nbsp;&nbsp;&nbsp;&nbsp;end<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;MonthValue&nbsp;=&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'JAN'&nbsp;=&gt;&nbsp;1,&nbsp;'FEB'&nbsp;=&gt;&nbsp;2,&nbsp;'MAR'&nbsp;=&gt;&nbsp;3,&nbsp;'APR'&nbsp;=&gt;&nbsp;4,&nbsp;'MAY'&nbsp;=&gt;&nbsp;5,&nbsp;'JUN'&nbsp;=&gt;&nbsp;6,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'JUL'&nbsp;=&gt;&nbsp;7,&nbsp;'AUG'&nbsp;=&gt;&nbsp;8,&nbsp;'SEP'&nbsp;=&gt;&nbsp;9,&nbsp;'OCT'&nbsp;=&gt;10,&nbsp;'NOV'&nbsp;=&gt;11,&nbsp;'DEC'&nbsp;=&gt;12<br />
&nbsp;&nbsp;&nbsp;&nbsp;}<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;#<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Parses&nbsp;+date+&nbsp;as&nbsp;date-time&nbsp;defined&nbsp;by&nbsp;RFC&nbsp;2822&nbsp;and&nbsp;converts&nbsp;it&nbsp;to&nbsp;a&nbsp;Time<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;object.&nbsp;&nbsp;The&nbsp;format&nbsp;is&nbsp;identical&nbsp;to&nbsp;the&nbsp;date&nbsp;format&nbsp;defined&nbsp;by&nbsp;RFC&nbsp;822&nbsp;and<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;updated&nbsp;by&nbsp;RFC&nbsp;1123.<br />
&nbsp;&nbsp;&nbsp;&nbsp;#<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;ArgumentError&nbsp;is&nbsp;raised&nbsp;if&nbsp;+date+&nbsp;is&nbsp;not&nbsp;compliant&nbsp;with&nbsp;RFC&nbsp;2822<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;or&nbsp;Time&nbsp;class&nbsp;cannot&nbsp;represent&nbsp;specified&nbsp;date.<br />
&nbsp;&nbsp;&nbsp;&nbsp;#<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;See&nbsp;#rfc2822&nbsp;for&nbsp;more&nbsp;information&nbsp;on&nbsp;this&nbsp;format.<br />
&nbsp;&nbsp;&nbsp;&nbsp;#<br />
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;rfc2822(date)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;/\A\s*<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(?:(?:Mon|Tue|Wed|Thu|Fri|Sat|Sun)\s*,\s*)?<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(\d{1,2})\s+<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s+<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(\d{2,})\s+<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(\d{2})\s*<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:\s*(\d{2})\s*<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(?::\s*(\d{2}))?\s+<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;([+-]\d{4}|<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UT|GMT|EST|EDT|CST|CDT|MST|MDT|PST|PDT|[A-IK-Z])/ix&nbsp;=~&nbsp;date<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Since&nbsp;RFC&nbsp;2822&nbsp;permit&nbsp;comments,&nbsp;the&nbsp;regexp&nbsp;has&nbsp;no&nbsp;right&nbsp;anchor.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;day&nbsp;=&nbsp;$1.to_i<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mon&nbsp;=&nbsp;MonthValue[$2.upcase]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;year&nbsp;=&nbsp;$3.to_i<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hour&nbsp;=&nbsp;$4.to_i<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;min&nbsp;=&nbsp;$5.to_i<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sec&nbsp;=&nbsp;$6&nbsp;?&nbsp;$6.to_i&nbsp;:&nbsp;0<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zone&nbsp;=&nbsp;$7<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;following&nbsp;year&nbsp;completion&nbsp;is&nbsp;compliant&nbsp;with&nbsp;RFC&nbsp;2822.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;year&nbsp;=&nbsp;if&nbsp;year&nbsp;&lt;&nbsp;50<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2000&nbsp;+&nbsp;year<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elsif&nbsp;year&nbsp;&lt;&nbsp;1000<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1900&nbsp;+&nbsp;year<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;year<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;year,&nbsp;mon,&nbsp;day,&nbsp;hour,&nbsp;min,&nbsp;sec&nbsp;=<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;apply_offset(year,&nbsp;mon,&nbsp;day,&nbsp;hour,&nbsp;min,&nbsp;sec,&nbsp;zone_offset(zone))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t&nbsp;=&nbsp;self.utc(year,&nbsp;mon,&nbsp;day,&nbsp;hour,&nbsp;min,&nbsp;sec)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.localtime&nbsp;if&nbsp;!zone_utc?(zone)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raise&nbsp;ArgumentError.new(&quot;not&nbsp;RFC&nbsp;2822&nbsp;compliant&nbsp;date:&nbsp;#{date.inspect}&quot;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<br />
&nbsp;&nbsp;&nbsp;&nbsp;end<br />
&nbsp;&nbsp;&nbsp;&nbsp;alias&nbsp;rfc822&nbsp;rfc2822<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;#<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Parses&nbsp;+date+&nbsp;as&nbsp;HTTP-date&nbsp;defined&nbsp;by&nbsp;RFC&nbsp;2616&nbsp;and&nbsp;converts&nbsp;it&nbsp;to&nbsp;a&nbsp;Time<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;object.<br />
&nbsp;&nbsp;&nbsp;&nbsp;#<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;ArgumentError&nbsp;is&nbsp;raised&nbsp;if&nbsp;+date+&nbsp;is&nbsp;not&nbsp;compliant&nbsp;with&nbsp;RFC&nbsp;2616&nbsp;or&nbsp;Time<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;class&nbsp;cannot&nbsp;represent&nbsp;specified&nbsp;date.<br />
&nbsp;&nbsp;&nbsp;&nbsp;#<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;See&nbsp;#httpdate&nbsp;for&nbsp;more&nbsp;information&nbsp;on&nbsp;this&nbsp;format.<br />
&nbsp;&nbsp;&nbsp;&nbsp;#<br />
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;httpdate(date)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;/\A\s*<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(?:Mon|Tue|Wed|Thu|Fri|Sat|Sun),\x20<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(\d{2})\x20<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\x20<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(\d{4})\x20<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(\d{2}):(\d{2}):(\d{2})\x20<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GMT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\s*\z/ix&nbsp;=~&nbsp;date<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.rfc2822(date)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elsif&nbsp;/\A\s*<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(?:Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday),\x20<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d)\x20<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(\d\d):(\d\d):(\d\d)\x20<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GMT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\s*\z/ix&nbsp;=~&nbsp;date<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.parse(date)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elsif&nbsp;/\A\s*<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(?:Mon|Tue|Wed|Thu|Fri|Sat|Sun)\x20<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\x20<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(\d\d|\x20\d)\x20<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(\d\d):(\d\d):(\d\d)\x20<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(\d{4})<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\s*\z/ix&nbsp;=~&nbsp;date<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.utc($6.to_i,&nbsp;MonthValue[$1.upcase],&nbsp;$2.to_i,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$3.to_i,&nbsp;$4.to_i,&nbsp;$5.to_i)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raise&nbsp;ArgumentError.new(&quot;not&nbsp;RFC&nbsp;2616&nbsp;compliant&nbsp;date:&nbsp;#{date.inspect}&quot;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<br />
&nbsp;&nbsp;&nbsp;&nbsp;end<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;#<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Parses&nbsp;+date+&nbsp;as&nbsp;dateTime&nbsp;defined&nbsp;by&nbsp;XML&nbsp;Schema&nbsp;and&nbsp;converts&nbsp;it&nbsp;to&nbsp;a&nbsp;Time<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;object.&nbsp;&nbsp;The&nbsp;format&nbsp;is&nbsp;restricted&nbsp;version&nbsp;of&nbsp;the&nbsp;format&nbsp;defined&nbsp;by&nbsp;ISO<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;8601.<br />
&nbsp;&nbsp;&nbsp;&nbsp;#<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;ArgumentError&nbsp;is&nbsp;raised&nbsp;if&nbsp;+date+&nbsp;is&nbsp;not&nbsp;compliant&nbsp;with&nbsp;the&nbsp;format&nbsp;or&nbsp;Time<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;class&nbsp;cannot&nbsp;represent&nbsp;specified&nbsp;date.<br />
&nbsp;&nbsp;&nbsp;&nbsp;#<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;See&nbsp;#xmlschema&nbsp;for&nbsp;more&nbsp;information&nbsp;on&nbsp;this&nbsp;format.<br />
&nbsp;&nbsp;&nbsp;&nbsp;#<br />
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;xmlschema(date)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;/\A\s*<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(-?\d+)-(\d\d)-(\d\d)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(\d\d):(\d\d):(\d\d)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(\.\d*)?<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(Z|[+-]\d\d:\d\d)?<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\s*\z/ix&nbsp;=~&nbsp;date<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;year&nbsp;=&nbsp;$1.to_i<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mon&nbsp;=&nbsp;$2.to_i<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;day&nbsp;=&nbsp;$3.to_i<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hour&nbsp;=&nbsp;$4.to_i<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;min&nbsp;=&nbsp;$5.to_i<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sec&nbsp;=&nbsp;$6.to_i<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;usec&nbsp;=&nbsp;0<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;usec&nbsp;=&nbsp;$7.to_f&nbsp;*&nbsp;1000000&nbsp;if&nbsp;$7<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;$8<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zone&nbsp;=&nbsp;$8<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;year,&nbsp;mon,&nbsp;day,&nbsp;hour,&nbsp;min,&nbsp;sec&nbsp;=<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;apply_offset(year,&nbsp;mon,&nbsp;day,&nbsp;hour,&nbsp;min,&nbsp;sec,&nbsp;zone_offset(zone))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.utc(year,&nbsp;mon,&nbsp;day,&nbsp;hour,&nbsp;min,&nbsp;sec,&nbsp;usec)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.local(year,&nbsp;mon,&nbsp;day,&nbsp;hour,&nbsp;min,&nbsp;sec,&nbsp;usec)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raise&nbsp;ArgumentError.new(&quot;invalid&nbsp;date:&nbsp;#{date.inspect}&quot;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<br />
&nbsp;&nbsp;&nbsp;&nbsp;end<br />
&nbsp;&nbsp;&nbsp;&nbsp;alias&nbsp;iso8601&nbsp;xmlschema<br />
&nbsp;&nbsp;end&nbsp;#&nbsp;class&nbsp;&lt;&lt;&nbsp;self<br />
<br />
&nbsp;&nbsp;#<br />
&nbsp;&nbsp;#&nbsp;Returns&nbsp;a&nbsp;string&nbsp;which&nbsp;represents&nbsp;the&nbsp;time&nbsp;as&nbsp;date-time&nbsp;defined&nbsp;by&nbsp;RFC&nbsp;2822:<br />
&nbsp;&nbsp;#<br />
&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;day-of-week,&nbsp;DD&nbsp;month-name&nbsp;CCYY&nbsp;hh:mm:ss&nbsp;zone<br />
&nbsp;&nbsp;#<br />
&nbsp;&nbsp;#&nbsp;where&nbsp;zone&nbsp;is&nbsp;[+-]hhmm.<br />
&nbsp;&nbsp;#<br />
&nbsp;&nbsp;#&nbsp;If&nbsp;+self+&nbsp;is&nbsp;a&nbsp;UTC&nbsp;time,&nbsp;-0000&nbsp;is&nbsp;used&nbsp;as&nbsp;zone.<br />
&nbsp;&nbsp;#<br />
&nbsp;&nbsp;def&nbsp;rfc2822<br />
&nbsp;&nbsp;&nbsp;&nbsp;sprintf('%s,&nbsp;%02d&nbsp;%s&nbsp;%d&nbsp;%02d:%02d:%02d&nbsp;',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RFC2822_DAY_NAME[wday],<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;day,&nbsp;RFC2822_MONTH_NAME[mon-1],&nbsp;year,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hour,&nbsp;min,&nbsp;sec)&nbsp;+<br />
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;utc?<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'-0000'<br />
&nbsp;&nbsp;&nbsp;&nbsp;else<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;off&nbsp;=&nbsp;utc_offset<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sign&nbsp;=&nbsp;off&nbsp;&lt;&nbsp;0&nbsp;?&nbsp;'-'&nbsp;:&nbsp;'+'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sprintf('%s%02d%02d',&nbsp;sign,&nbsp;*(off.abs&nbsp;/&nbsp;60).divmod(60))<br />
&nbsp;&nbsp;&nbsp;&nbsp;end<br />
&nbsp;&nbsp;end<br />
&nbsp;&nbsp;alias&nbsp;rfc822&nbsp;rfc2822<br />
<br />
&nbsp;&nbsp;RFC2822_DAY_NAME&nbsp;=&nbsp;[<br />
&nbsp;&nbsp;&nbsp;&nbsp;'Sun',&nbsp;'Mon',&nbsp;'Tue',&nbsp;'Wed',&nbsp;'Thu',&nbsp;'Fri',&nbsp;'Sat'<br />
&nbsp;&nbsp;]<br />
&nbsp;&nbsp;RFC2822_MONTH_NAME&nbsp;=&nbsp;[<br />
&nbsp;&nbsp;&nbsp;&nbsp;'Jan',&nbsp;'Feb',&nbsp;'Mar',&nbsp;'Apr',&nbsp;'May',&nbsp;'Jun',<br />
&nbsp;&nbsp;&nbsp;&nbsp;'Jul',&nbsp;'Aug',&nbsp;'Sep',&nbsp;'Oct',&nbsp;'Nov',&nbsp;'Dec'<br />
&nbsp;&nbsp;]<br />
<br />
&nbsp;&nbsp;#<br />
&nbsp;&nbsp;#&nbsp;Returns&nbsp;a&nbsp;string&nbsp;which&nbsp;represents&nbsp;the&nbsp;time&nbsp;as&nbsp;rfc1123-date&nbsp;of&nbsp;HTTP-date<br />
&nbsp;&nbsp;#&nbsp;defined&nbsp;by&nbsp;RFC&nbsp;2616:&nbsp;<br />
&nbsp;&nbsp;#&nbsp;<br />
&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;day-of-week,&nbsp;DD&nbsp;month-name&nbsp;CCYY&nbsp;hh:mm:ss&nbsp;GMT<br />
&nbsp;&nbsp;#<br />
&nbsp;&nbsp;#&nbsp;Note&nbsp;that&nbsp;the&nbsp;result&nbsp;is&nbsp;always&nbsp;UTC&nbsp;(GMT).<br />
&nbsp;&nbsp;#<br />
&nbsp;&nbsp;def&nbsp;httpdate<br />
&nbsp;&nbsp;&nbsp;&nbsp;t&nbsp;=&nbsp;dup.utc<br />
&nbsp;&nbsp;&nbsp;&nbsp;sprintf('%s,&nbsp;%02d&nbsp;%s&nbsp;%d&nbsp;%02d:%02d:%02d&nbsp;GMT',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RFC2822_DAY_NAME[t.wday],<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.day,&nbsp;RFC2822_MONTH_NAME[t.mon-1],&nbsp;t.year,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t.hour,&nbsp;t.min,&nbsp;t.sec)<br />
&nbsp;&nbsp;end<br />
<br />
&nbsp;&nbsp;#<br />
&nbsp;&nbsp;#&nbsp;Returns&nbsp;a&nbsp;string&nbsp;which&nbsp;represents&nbsp;the&nbsp;time&nbsp;as&nbsp;dateTime&nbsp;defined&nbsp;by&nbsp;XML<br />
&nbsp;&nbsp;#&nbsp;Schema:<br />
&nbsp;&nbsp;#<br />
&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;CCYY-MM-DDThh:mm:ssTZD<br />
&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;CCYY-MM-DDThh:mm:ss.sssTZD<br />
&nbsp;&nbsp;#<br />
&nbsp;&nbsp;#&nbsp;where&nbsp;TZD&nbsp;is&nbsp;Z&nbsp;or&nbsp;[+-]hh:mm.<br />
&nbsp;&nbsp;#<br />
&nbsp;&nbsp;#&nbsp;If&nbsp;self&nbsp;is&nbsp;a&nbsp;UTC&nbsp;time,&nbsp;Z&nbsp;is&nbsp;used&nbsp;as&nbsp;TZD.&nbsp;&nbsp;[+-]hh:mm&nbsp;is&nbsp;used&nbsp;otherwise.<br />
&nbsp;&nbsp;#<br />
&nbsp;&nbsp;#&nbsp;+fractional_seconds+&nbsp;specifies&nbsp;a&nbsp;number&nbsp;of&nbsp;digits&nbsp;of&nbsp;fractional&nbsp;seconds.<br />
&nbsp;&nbsp;#&nbsp;Its&nbsp;default&nbsp;value&nbsp;is&nbsp;0.<br />
&nbsp;&nbsp;#<br />
&nbsp;&nbsp;def&nbsp;xmlschema(fraction_digits=0)<br />
&nbsp;&nbsp;&nbsp;&nbsp;sprintf('%d-%02d-%02dT%02d:%02d:%02d',<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;year,&nbsp;mon,&nbsp;day,&nbsp;hour,&nbsp;min,&nbsp;sec)&nbsp;+<br />
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;fraction_digits&nbsp;==&nbsp;0<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;''<br />
&nbsp;&nbsp;&nbsp;&nbsp;elsif&nbsp;fraction_digits&nbsp;&lt;=&nbsp;6<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'.'&nbsp;+&nbsp;sprintf('%06d',&nbsp;usec)[0,&nbsp;fraction_digits]<br />
&nbsp;&nbsp;&nbsp;&nbsp;else<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'.'&nbsp;+&nbsp;sprintf('%06d',&nbsp;usec)&nbsp;+&nbsp;'0'&nbsp;*&nbsp;(fraction_digits&nbsp;-&nbsp;6)<br />
&nbsp;&nbsp;&nbsp;&nbsp;end&nbsp;+<br />
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;utc?<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'Z'<br />
&nbsp;&nbsp;&nbsp;&nbsp;else<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;off&nbsp;=&nbsp;utc_offset<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sign&nbsp;=&nbsp;off&nbsp;&lt;&nbsp;0&nbsp;?&nbsp;'-'&nbsp;:&nbsp;'+'<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sprintf('%s%02d:%02d',&nbsp;sign,&nbsp;*(off.abs&nbsp;/&nbsp;60).divmod(60))<br />
&nbsp;&nbsp;&nbsp;&nbsp;end<br />
&nbsp;&nbsp;end<br />
&nbsp;&nbsp;alias&nbsp;iso8601&nbsp;xmlschema<br />
end<br />
<br />
if&nbsp;__FILE__&nbsp;==&nbsp;$0<br />
&nbsp;&nbsp;require&nbsp;'test/unit'<br />
<br />
&nbsp;&nbsp;class&nbsp;TimeExtentionTest&nbsp;&lt;&nbsp;Test::Unit::TestCase&nbsp;#&nbsp;:nodoc:<br />
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_rfc822<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(Time.utc(1976,&nbsp;8,&nbsp;26,&nbsp;14,&nbsp;30)&nbsp;+&nbsp;4&nbsp;*&nbsp;3600,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.rfc2822(&quot;26&nbsp;Aug&nbsp;76&nbsp;14:30&nbsp;EDT&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(Time.utc(1976,&nbsp;8,&nbsp;27,&nbsp;9,&nbsp;32)&nbsp;+&nbsp;7&nbsp;*&nbsp;3600,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.rfc2822(&quot;27&nbsp;Aug&nbsp;76&nbsp;09:32&nbsp;PDT&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;end<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_rfc2822<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(Time.utc(1997,&nbsp;11,&nbsp;21,&nbsp;9,&nbsp;55,&nbsp;6)&nbsp;+&nbsp;6&nbsp;*&nbsp;3600,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.rfc2822(&quot;Fri,&nbsp;21&nbsp;Nov&nbsp;1997&nbsp;09:55:06&nbsp;-0600&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(Time.utc(2003,&nbsp;7,&nbsp;1,&nbsp;10,&nbsp;52,&nbsp;37)&nbsp;-&nbsp;2&nbsp;*&nbsp;3600,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.rfc2822(&quot;Tue,&nbsp;1&nbsp;Jul&nbsp;2003&nbsp;10:52:37&nbsp;+0200&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(Time.utc(1997,&nbsp;11,&nbsp;21,&nbsp;10,&nbsp;1,&nbsp;10)&nbsp;+&nbsp;6&nbsp;*&nbsp;3600,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.rfc2822(&quot;Fri,&nbsp;21&nbsp;Nov&nbsp;1997&nbsp;10:01:10&nbsp;-0600&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(Time.utc(1997,&nbsp;11,&nbsp;21,&nbsp;11,&nbsp;0,&nbsp;0)&nbsp;+&nbsp;6&nbsp;*&nbsp;3600,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.rfc2822(&quot;Fri,&nbsp;21&nbsp;Nov&nbsp;1997&nbsp;11:00:00&nbsp;-0600&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(Time.utc(1997,&nbsp;11,&nbsp;24,&nbsp;14,&nbsp;22,&nbsp;1)&nbsp;+&nbsp;8&nbsp;*&nbsp;3600,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.rfc2822(&quot;Mon,&nbsp;24&nbsp;Nov&nbsp;1997&nbsp;14:22:01&nbsp;-0800&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;begin<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.at(-1)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rescue&nbsp;ArgumentError<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;ignore<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(Time.utc(1969,&nbsp;2,&nbsp;13,&nbsp;23,&nbsp;32,&nbsp;54)&nbsp;+&nbsp;3&nbsp;*&nbsp;3600&nbsp;+&nbsp;30&nbsp;*&nbsp;60,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.rfc2822(&quot;Thu,&nbsp;13&nbsp;Feb&nbsp;1969&nbsp;23:32:54&nbsp;-0330&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(Time.utc(1969,&nbsp;2,&nbsp;13,&nbsp;23,&nbsp;32,&nbsp;0)&nbsp;+&nbsp;3&nbsp;*&nbsp;3600&nbsp;+&nbsp;30&nbsp;*&nbsp;60,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.rfc2822(&quot;&nbsp;Thu,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;13<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Feb<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1969<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;23:32<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-0330&nbsp;(Newfoundland&nbsp;Time)&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(Time.utc(1997,&nbsp;11,&nbsp;21,&nbsp;9,&nbsp;55,&nbsp;6),<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.rfc2822(&quot;21&nbsp;Nov&nbsp;97&nbsp;09:55:06&nbsp;GMT&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(Time.utc(1997,&nbsp;11,&nbsp;21,&nbsp;9,&nbsp;55,&nbsp;6)&nbsp;+&nbsp;6&nbsp;*&nbsp;3600,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.rfc2822(&quot;Fri,&nbsp;21&nbsp;Nov&nbsp;1997&nbsp;09&nbsp;:&nbsp;&nbsp;&nbsp;55&nbsp;&nbsp;:&nbsp;&nbsp;06&nbsp;-0600&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;inner&nbsp;comment&nbsp;is&nbsp;not&nbsp;supported.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.rfc2822(&quot;Fri,&nbsp;21&nbsp;Nov&nbsp;1997&nbsp;09(comment):&nbsp;&nbsp;&nbsp;55&nbsp;&nbsp;:&nbsp;&nbsp;06&nbsp;-0600&quot;)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;end<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_rfc2616<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t&nbsp;=&nbsp;Time.utc(1994,&nbsp;11,&nbsp;6,&nbsp;8,&nbsp;49,&nbsp;37)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.httpdate(&quot;Sun,&nbsp;06&nbsp;Nov&nbsp;1994&nbsp;08:49:37&nbsp;GMT&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.httpdate(&quot;Sunday,&nbsp;06-Nov-94&nbsp;08:49:37&nbsp;GMT&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.httpdate(&quot;Sun&nbsp;Nov&nbsp;&nbsp;6&nbsp;08:49:37&nbsp;1994&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(Time.utc(1995,&nbsp;11,&nbsp;15,&nbsp;6,&nbsp;25,&nbsp;24),<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.httpdate(&quot;Wed,&nbsp;15&nbsp;Nov&nbsp;1995&nbsp;06:25:24&nbsp;GMT&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(Time.utc(1995,&nbsp;11,&nbsp;15,&nbsp;4,&nbsp;58,&nbsp;8),<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.httpdate(&quot;Wed,&nbsp;15&nbsp;Nov&nbsp;1995&nbsp;04:58:08&nbsp;GMT&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(Time.utc(1994,&nbsp;11,&nbsp;15,&nbsp;8,&nbsp;12,&nbsp;31),<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.httpdate(&quot;Tue,&nbsp;15&nbsp;Nov&nbsp;1994&nbsp;08:12:31&nbsp;GMT&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(Time.utc(1994,&nbsp;12,&nbsp;1,&nbsp;16,&nbsp;0,&nbsp;0),<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.httpdate(&quot;Thu,&nbsp;01&nbsp;Dec&nbsp;1994&nbsp;16:00:00&nbsp;GMT&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(Time.utc(1994,&nbsp;10,&nbsp;29,&nbsp;19,&nbsp;43,&nbsp;31),<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.httpdate(&quot;Sat,&nbsp;29&nbsp;Oct&nbsp;1994&nbsp;19:43:31&nbsp;GMT&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(Time.utc(1994,&nbsp;11,&nbsp;15,&nbsp;12,&nbsp;45,&nbsp;26),<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.httpdate(&quot;Tue,&nbsp;15&nbsp;Nov&nbsp;1994&nbsp;12:45:26&nbsp;GMT&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(Time.utc(1999,&nbsp;12,&nbsp;31,&nbsp;23,&nbsp;59,&nbsp;59),<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.httpdate(&quot;Fri,&nbsp;31&nbsp;Dec&nbsp;1999&nbsp;23:59:59&nbsp;GMT&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;end<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_rfc3339<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t&nbsp;=&nbsp;Time.utc(1985,&nbsp;4,&nbsp;12,&nbsp;23,&nbsp;20,&nbsp;50,&nbsp;520000)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s&nbsp;=&nbsp;&quot;1985-04-12T23:20:50.52Z&quot;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.iso8601(s))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(s,&nbsp;t.iso8601(2))<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t&nbsp;=&nbsp;Time.utc(1996,&nbsp;12,&nbsp;20,&nbsp;0,&nbsp;39,&nbsp;57)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s&nbsp;=&nbsp;&quot;1996-12-19T16:39:57-08:00&quot;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.iso8601(s))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;There&nbsp;is&nbsp;no&nbsp;way&nbsp;to&nbsp;generate&nbsp;time&nbsp;string&nbsp;with&nbsp;arbitrary&nbsp;timezone.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s&nbsp;=&nbsp;&quot;1996-12-20T00:39:57Z&quot;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.iso8601(s))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(s,&nbsp;t.iso8601)<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t&nbsp;=&nbsp;Time.utc(1990,&nbsp;12,&nbsp;31,&nbsp;23,&nbsp;59,&nbsp;60)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s&nbsp;=&nbsp;&quot;1990-12-31T23:59:60Z&quot;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.iso8601(s))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;leap&nbsp;second&nbsp;is&nbsp;representable&nbsp;only&nbsp;if&nbsp;timezone&nbsp;file&nbsp;has&nbsp;it.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s&nbsp;=&nbsp;&quot;1990-12-31T15:59:60-08:00&quot;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.iso8601(s))<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;begin<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.at(-1)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rescue&nbsp;ArgumentError<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;ignore<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t&nbsp;=&nbsp;Time.utc(1937,&nbsp;1,&nbsp;1,&nbsp;11,&nbsp;40,&nbsp;27,&nbsp;870000)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s&nbsp;=&nbsp;&quot;1937-01-01T12:00:27.87+00:20&quot;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.iso8601(s))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<br />
&nbsp;&nbsp;&nbsp;&nbsp;end<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;http://www.w3.org/TR/xmlschema-2/<br />
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_xmlschema<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(Time.utc(1999,&nbsp;5,&nbsp;31,&nbsp;13,&nbsp;20,&nbsp;0)&nbsp;+&nbsp;5&nbsp;*&nbsp;3600,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.xmlschema(&quot;1999-05-31T13:20:00-05:00&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(Time.local(2000,&nbsp;1,&nbsp;20,&nbsp;12,&nbsp;0,&nbsp;0),<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.xmlschema(&quot;2000-01-20T12:00:00&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(Time.utc(2000,&nbsp;1,&nbsp;20,&nbsp;12,&nbsp;0,&nbsp;0),<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.xmlschema(&quot;2000-01-20T12:00:00Z&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(Time.utc(2000,&nbsp;1,&nbsp;20,&nbsp;12,&nbsp;0,&nbsp;0)&nbsp;-&nbsp;12&nbsp;*&nbsp;3600,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.xmlschema(&quot;2000-01-20T12:00:00+12:00&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(Time.utc(2000,&nbsp;1,&nbsp;20,&nbsp;12,&nbsp;0,&nbsp;0)&nbsp;+&nbsp;13&nbsp;*&nbsp;3600,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.xmlschema(&quot;2000-01-20T12:00:00-13:00&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(Time.utc(2000,&nbsp;3,&nbsp;4,&nbsp;23,&nbsp;0,&nbsp;0)&nbsp;-&nbsp;3&nbsp;*&nbsp;3600,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.xmlschema(&quot;2000-03-04T23:00:00+03:00&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(Time.utc(2000,&nbsp;3,&nbsp;4,&nbsp;20,&nbsp;0,&nbsp;0),<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.xmlschema(&quot;2000-03-04T20:00:00Z&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(Time.local(2000,&nbsp;1,&nbsp;15,&nbsp;0,&nbsp;0,&nbsp;0),<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.xmlschema(&quot;2000-01-15T00:00:00&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(Time.local(2000,&nbsp;2,&nbsp;15,&nbsp;0,&nbsp;0,&nbsp;0),<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.xmlschema(&quot;2000-02-15T00:00:00&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(Time.local(2000,&nbsp;1,&nbsp;15,&nbsp;12,&nbsp;0,&nbsp;0),<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.xmlschema(&quot;2000-01-15T12:00:00&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(Time.utc(2000,&nbsp;1,&nbsp;16,&nbsp;12,&nbsp;0,&nbsp;0),<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.xmlschema(&quot;2000-01-16T12:00:00Z&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(Time.local(2000,&nbsp;1,&nbsp;1,&nbsp;12,&nbsp;0,&nbsp;0),<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.xmlschema(&quot;2000-01-01T12:00:00&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(Time.utc(1999,&nbsp;12,&nbsp;31,&nbsp;23,&nbsp;0,&nbsp;0),<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.xmlschema(&quot;1999-12-31T23:00:00Z&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(Time.local(2000,&nbsp;1,&nbsp;16,&nbsp;12,&nbsp;0,&nbsp;0),<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.xmlschema(&quot;2000-01-16T12:00:00&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(Time.local(2000,&nbsp;1,&nbsp;16,&nbsp;0,&nbsp;0,&nbsp;0),<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.xmlschema(&quot;2000-01-16T00:00:00&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(Time.utc(2000,&nbsp;1,&nbsp;12,&nbsp;12,&nbsp;13,&nbsp;14),<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.xmlschema(&quot;2000-01-12T12:13:14Z&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(Time.utc(2001,&nbsp;4,&nbsp;17,&nbsp;19,&nbsp;23,&nbsp;17,&nbsp;300000),<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.xmlschema(&quot;2001-04-17T19:23:17.3Z&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;end<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_encode_xmlschema<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t&nbsp;=&nbsp;Time.utc(2001,&nbsp;4,&nbsp;17,&nbsp;19,&nbsp;23,&nbsp;17,&nbsp;300000)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(&quot;2001-04-17T19:23:17Z&quot;,&nbsp;t.xmlschema)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(&quot;2001-04-17T19:23:17.3Z&quot;,&nbsp;t.xmlschema(1))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(&quot;2001-04-17T19:23:17.300000Z&quot;,&nbsp;t.xmlschema(6))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(&quot;2001-04-17T19:23:17.3000000Z&quot;,&nbsp;t.xmlschema(7))<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t&nbsp;=&nbsp;Time.utc(2001,&nbsp;4,&nbsp;17,&nbsp;19,&nbsp;23,&nbsp;17,&nbsp;123456)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(&quot;2001-04-17T19:23:17.1234560Z&quot;,&nbsp;t.xmlschema(7))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(&quot;2001-04-17T19:23:17.123456Z&quot;,&nbsp;t.xmlschema(6))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(&quot;2001-04-17T19:23:17.12345Z&quot;,&nbsp;t.xmlschema(5))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(&quot;2001-04-17T19:23:17.1Z&quot;,&nbsp;t.xmlschema(1))<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;begin<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.at(-1)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rescue&nbsp;ArgumentError<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;ignore<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t&nbsp;=&nbsp;Time.utc(1960,&nbsp;12,&nbsp;31,&nbsp;23,&nbsp;0,&nbsp;0,&nbsp;123456)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(&quot;1960-12-31T23:00:00.123456Z&quot;,&nbsp;t.xmlschema(6))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end<br />
&nbsp;&nbsp;&nbsp;&nbsp;end<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_completion<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;now&nbsp;=&nbsp;Time.local(2001,11,29,21,26,35)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(Time.local(&nbsp;2001,11,29,21,12),<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.parse(&quot;2001/11/29&nbsp;21:12&quot;,&nbsp;now))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(Time.local(&nbsp;2001,11,29),<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.parse(&quot;2001/11/29&quot;,&nbsp;now))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(Time.local(&nbsp;2001,11,29),<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.parse(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;11/29&quot;,&nbsp;now))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#assert_equal(Time.local(2001,11,1),&nbsp;Time.parse(&quot;Nov&quot;,&nbsp;now))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(Time.local(&nbsp;2001,11,29,10,22),<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time.parse(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;10:22&quot;,&nbsp;now))<br />
&nbsp;&nbsp;&nbsp;&nbsp;end<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_invalid<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;They&nbsp;were&nbsp;actually&nbsp;used&nbsp;in&nbsp;some&nbsp;web&nbsp;sites.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.httpdate(&quot;1&nbsp;Dec&nbsp;2001&nbsp;10:23:57&nbsp;GMT&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.httpdate(&quot;Sat,&nbsp;1&nbsp;Dec&nbsp;2001&nbsp;10:25:42&nbsp;GMT&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.httpdate(&quot;Sat,&nbsp;&nbsp;1-Dec-2001&nbsp;10:53:55&nbsp;GMT&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.httpdate(&quot;Saturday,&nbsp;01-Dec-2001&nbsp;10:15:34&nbsp;GMT&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.httpdate(&quot;Saturday,&nbsp;01-Dec-101&nbsp;11:10:07&nbsp;GMT&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.httpdate(&quot;Fri,&nbsp;30&nbsp;Nov&nbsp;2001&nbsp;21:30:00&nbsp;JST&quot;)&nbsp;}<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;They&nbsp;were&nbsp;actually&nbsp;used&nbsp;in&nbsp;some&nbsp;mails.<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;01-5-20&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;7/21/00&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;2001-8-28&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;00-5-6&nbsp;1:13:06&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;2001-9-27&nbsp;9:36:49&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;2000-12-13&nbsp;11:01:11&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;2001/10/17&nbsp;04:29:55&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;9/4/2001&nbsp;9:23:19&nbsp;PM&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;01&nbsp;Nov&nbsp;2001&nbsp;09:04:31&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;13&nbsp;Feb&nbsp;2001&nbsp;16:4&nbsp;GMT&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;01&nbsp;Oct&nbsp;00&nbsp;5:41:19&nbsp;PM&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;2&nbsp;Jul&nbsp;00&nbsp;00:51:37&nbsp;JST&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;01&nbsp;11&nbsp;2001&nbsp;06:55:57&nbsp;-0500&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;18&nbsp;\343\366\356\341\370&nbsp;2000&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;Fri,&nbsp;Oct&nbsp;2001&nbsp;&nbsp;18:53:32&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;Fri,&nbsp;2&nbsp;Nov&nbsp;2001&nbsp;03:47:54&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;Fri,&nbsp;27&nbsp;Jul&nbsp;2001&nbsp;11.14.14&nbsp;+0200&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;Thu,&nbsp;2&nbsp;Nov&nbsp;2000&nbsp;04:13:53&nbsp;-600&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;Wed,&nbsp;5&nbsp;Apr&nbsp;2000&nbsp;22:57:09&nbsp;JST&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;Mon,&nbsp;11&nbsp;Sep&nbsp;2000&nbsp;19:47:33&nbsp;00000&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;Fri,&nbsp;28&nbsp;Apr&nbsp;2000&nbsp;20:40:47&nbsp;+-900&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;Fri,&nbsp;19&nbsp;Jan&nbsp;2001&nbsp;8:15:36&nbsp;AM&nbsp;-0500&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;Thursday,&nbsp;Sep&nbsp;27&nbsp;2001&nbsp;7:42:35&nbsp;AM&nbsp;EST&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;3/11/2001&nbsp;1:31:57&nbsp;PM&nbsp;Pacific&nbsp;Daylight&nbsp;Time&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;Mi,&nbsp;28&nbsp;Mrz&nbsp;2001&nbsp;11:51:36&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;P,&nbsp;30&nbsp;sept&nbsp;2001&nbsp;23:03:14&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;fr,&nbsp;11&nbsp;aug&nbsp;2000&nbsp;18:39:22&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;Fr,&nbsp;21&nbsp;Sep&nbsp;2001&nbsp;17:44:03&nbsp;-1000&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;Mo,&nbsp;18&nbsp;Jun&nbsp;2001&nbsp;19:21:40&nbsp;-1000&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;l\366,&nbsp;12&nbsp;aug&nbsp;2000&nbsp;18:53:20&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;l\366,&nbsp;26&nbsp;maj&nbsp;2001&nbsp;00:15:58&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;Dom,&nbsp;30&nbsp;Sep&nbsp;2001&nbsp;17:36:30&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;%&amp;,&nbsp;31&nbsp;%2/&nbsp;2000&nbsp;15:44:47&nbsp;-0500&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;dom,&nbsp;26&nbsp;ago&nbsp;2001&nbsp;03:57:07&nbsp;-0300&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;ter,&nbsp;04&nbsp;set&nbsp;2001&nbsp;16:27:58&nbsp;-0300&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;Wen,&nbsp;3&nbsp;oct&nbsp;2001&nbsp;23:17:49&nbsp;-0400&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;Wen,&nbsp;3&nbsp;oct&nbsp;2001&nbsp;23:17:49&nbsp;-0400&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;ele,&nbsp;11&nbsp;h:&nbsp;2000&nbsp;12:42:15&nbsp;-0500&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;Tue,&nbsp;14&nbsp;Aug&nbsp;2001&nbsp;3:55:3&nbsp;+0200&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;Fri,&nbsp;25&nbsp;Aug&nbsp;2000&nbsp;9:3:48&nbsp;+0800&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;Fri,&nbsp;1&nbsp;Dec&nbsp;2000&nbsp;0:57:50&nbsp;EST&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;Mon,&nbsp;7&nbsp;May&nbsp;2001&nbsp;9:39:51&nbsp;+0200&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;Wed,&nbsp;1&nbsp;Aug&nbsp;2001&nbsp;16:9:15&nbsp;+0200&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;Wed,&nbsp;23&nbsp;Aug&nbsp;2000&nbsp;9:17:36&nbsp;+0800&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;Fri,&nbsp;11&nbsp;Aug&nbsp;2000&nbsp;10:4:42&nbsp;+0800&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;Sat,&nbsp;15&nbsp;Sep&nbsp;2001&nbsp;13:22:2&nbsp;+0300&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;Wed,16&nbsp;\276\305\324\302&nbsp;2001&nbsp;20:06:25&nbsp;+0800&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;Wed,7&nbsp;\312\256\322\273\324\302&nbsp;2001&nbsp;23:47:22&nbsp;+0800&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;(),&nbsp;10&nbsp;&nbsp;&nbsp;2&nbsp;2001&nbsp;23:32:26&nbsp;+0900&nbsp;(JST)&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;\307\341\314\343\332\311,&nbsp;30&nbsp;\344\346\335\343\310\321&nbsp;2001&nbsp;10:01:06&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_raise(ArgumentError)&nbsp;{&nbsp;Time.rfc2822(&quot;(),&nbsp;12&nbsp;&nbsp;9&nbsp;2001&nbsp;14:52:41\n+0900&nbsp;(JST)&quot;)&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;end<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_zone_0000<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(true,&nbsp;Time.parse(&quot;2000-01-01T00:00:00Z&quot;).utc?)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(true,&nbsp;Time.parse(&quot;2000-01-01T00:00:00-00:00&quot;).utc?)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(false,&nbsp;Time.parse(&quot;2000-01-01T00:00:00+00:00&quot;).utc?)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(false,&nbsp;Time.parse(&quot;Sat,&nbsp;01&nbsp;Jan&nbsp;2000&nbsp;00:00:00&nbsp;GMT&quot;).utc?)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(true,&nbsp;Time.parse(&quot;Sat,&nbsp;01&nbsp;Jan&nbsp;2000&nbsp;00:00:00&nbsp;-0000&quot;).utc?)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(false,&nbsp;Time.parse(&quot;Sat,&nbsp;01&nbsp;Jan&nbsp;2000&nbsp;00:00:00&nbsp;+0000&quot;).utc?)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(false,&nbsp;Time.rfc2822(&quot;Sat,&nbsp;01&nbsp;Jan&nbsp;2000&nbsp;00:00:00&nbsp;GMT&quot;).utc?)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(true,&nbsp;Time.rfc2822(&quot;Sat,&nbsp;01&nbsp;Jan&nbsp;2000&nbsp;00:00:00&nbsp;-0000&quot;).utc?)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(false,&nbsp;Time.rfc2822(&quot;Sat,&nbsp;01&nbsp;Jan&nbsp;2000&nbsp;00:00:00&nbsp;+0000&quot;).utc?)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(true,&nbsp;Time.rfc2822(&quot;Sat,&nbsp;01&nbsp;Jan&nbsp;2000&nbsp;00:00:00&nbsp;UTC&quot;).utc?)<br />
&nbsp;&nbsp;&nbsp;&nbsp;end<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_parse_leap_second<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t&nbsp;=&nbsp;Time.utc(1998,12,31,23,59,59)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.parse(&quot;Thu&nbsp;Dec&nbsp;31&nbsp;23:59:59&nbsp;UTC&nbsp;1998&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.parse(&quot;Fri&nbsp;Dec&nbsp;31&nbsp;23:59:59&nbsp;-0000&nbsp;1998&quot;));t.localtime<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.parse(&quot;Fri&nbsp;Jan&nbsp;&nbsp;1&nbsp;08:59:59&nbsp;+0900&nbsp;1999&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.parse(&quot;Fri&nbsp;Jan&nbsp;&nbsp;1&nbsp;00:59:59&nbsp;+0100&nbsp;1999&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.parse(&quot;Fri&nbsp;Dec&nbsp;31&nbsp;23:59:59&nbsp;+0000&nbsp;1998&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.parse(&quot;Fri&nbsp;Dec&nbsp;31&nbsp;22:59:59&nbsp;-0100&nbsp;1998&quot;));t.utc<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t&nbsp;+=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.parse(&quot;Thu&nbsp;Dec&nbsp;31&nbsp;23:59:60&nbsp;UTC&nbsp;1998&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.parse(&quot;Fri&nbsp;Dec&nbsp;31&nbsp;23:59:60&nbsp;-0000&nbsp;1998&quot;));t.localtime<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.parse(&quot;Fri&nbsp;Jan&nbsp;&nbsp;1&nbsp;08:59:60&nbsp;+0900&nbsp;1999&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.parse(&quot;Fri&nbsp;Jan&nbsp;&nbsp;1&nbsp;00:59:60&nbsp;+0100&nbsp;1999&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.parse(&quot;Fri&nbsp;Dec&nbsp;31&nbsp;23:59:60&nbsp;+0000&nbsp;1998&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.parse(&quot;Fri&nbsp;Dec&nbsp;31&nbsp;22:59:60&nbsp;-0100&nbsp;1998&quot;));t.utc<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t&nbsp;+=&nbsp;1&nbsp;if&nbsp;t.sec&nbsp;==&nbsp;60<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.parse(&quot;Thu&nbsp;Jan&nbsp;&nbsp;1&nbsp;00:00:00&nbsp;UTC&nbsp;1999&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.parse(&quot;Fri&nbsp;Jan&nbsp;&nbsp;1&nbsp;00:00:00&nbsp;-0000&nbsp;1999&quot;));t.localtime<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.parse(&quot;Fri&nbsp;Jan&nbsp;&nbsp;1&nbsp;09:00:00&nbsp;+0900&nbsp;1999&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.parse(&quot;Fri&nbsp;Jan&nbsp;&nbsp;1&nbsp;01:00:00&nbsp;+0100&nbsp;1999&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.parse(&quot;Fri&nbsp;Jan&nbsp;&nbsp;1&nbsp;00:00:00&nbsp;+0000&nbsp;1999&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.parse(&quot;Fri&nbsp;Dec&nbsp;31&nbsp;23:00:00&nbsp;-0100&nbsp;1998&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;end<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_rfc2822_leap_second<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t&nbsp;=&nbsp;Time.utc(1998,12,31,23,59,59)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.rfc2822(&quot;Thu,&nbsp;31&nbsp;Dec&nbsp;1998&nbsp;23:59:59&nbsp;UTC&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.rfc2822(&quot;Fri,&nbsp;31&nbsp;Dec&nbsp;1998&nbsp;23:59:59&nbsp;-0000&quot;));t.localtime&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.rfc2822(&quot;Fri,&nbsp;&nbsp;1&nbsp;Jan&nbsp;1999&nbsp;08:59:59&nbsp;+0900&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.rfc2822(&quot;Fri,&nbsp;&nbsp;1&nbsp;Jan&nbsp;1999&nbsp;00:59:59&nbsp;+0100&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.rfc2822(&quot;Fri,&nbsp;31&nbsp;Dec&nbsp;1998&nbsp;23:59:59&nbsp;+0000&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.rfc2822(&quot;Fri,&nbsp;31&nbsp;Dec&nbsp;1998&nbsp;22:59:59&nbsp;-0100&quot;));t.utc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t&nbsp;+=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.rfc2822(&quot;Thu,&nbsp;31&nbsp;Dec&nbsp;1998&nbsp;23:59:60&nbsp;UTC&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.rfc2822(&quot;Fri,&nbsp;31&nbsp;Dec&nbsp;1998&nbsp;23:59:60&nbsp;-0000&quot;));t.localtime&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.rfc2822(&quot;Fri,&nbsp;&nbsp;1&nbsp;Jan&nbsp;1999&nbsp;08:59:60&nbsp;+0900&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.rfc2822(&quot;Fri,&nbsp;&nbsp;1&nbsp;Jan&nbsp;1999&nbsp;00:59:60&nbsp;+0100&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.rfc2822(&quot;Fri,&nbsp;31&nbsp;Dec&nbsp;1998&nbsp;23:59:60&nbsp;+0000&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.rfc2822(&quot;Fri,&nbsp;31&nbsp;Dec&nbsp;1998&nbsp;22:59:60&nbsp;-0100&quot;));t.utc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t&nbsp;+=&nbsp;1&nbsp;if&nbsp;t.sec&nbsp;==&nbsp;60<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.rfc2822(&quot;Thu,&nbsp;&nbsp;1&nbsp;Jan&nbsp;1999&nbsp;00:00:00&nbsp;UTC&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.rfc2822(&quot;Fri,&nbsp;&nbsp;1&nbsp;Jan&nbsp;1999&nbsp;00:00:00&nbsp;-0000&quot;));t.localtime&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.rfc2822(&quot;Fri,&nbsp;&nbsp;1&nbsp;Jan&nbsp;1999&nbsp;09:00:00&nbsp;+0900&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.rfc2822(&quot;Fri,&nbsp;&nbsp;1&nbsp;Jan&nbsp;1999&nbsp;01:00:00&nbsp;+0100&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.rfc2822(&quot;Fri,&nbsp;&nbsp;1&nbsp;Jan&nbsp;1999&nbsp;00:00:00&nbsp;+0000&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.rfc2822(&quot;Fri,&nbsp;31&nbsp;Dec&nbsp;1998&nbsp;23:00:00&nbsp;-0100&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;end<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_xmlschema_leap_second<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t&nbsp;=&nbsp;Time.utc(1998,12,31,23,59,59)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.xmlschema(&quot;1998-12-31T23:59:59Z&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.xmlschema(&quot;1998-12-31T23:59:59-00:00&quot;));t.localtime<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.xmlschema(&quot;1999-01-01T08:59:59+09:00&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.xmlschema(&quot;1999-01-01T00:59:59+01:00&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.xmlschema(&quot;1998-12-31T23:59:59+00:00&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.xmlschema(&quot;1998-12-31T22:59:59-01:00&quot;));t.utc<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t&nbsp;+=&nbsp;1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.xmlschema(&quot;1998-12-31T23:59:60Z&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.xmlschema(&quot;1998-12-31T23:59:60-00:00&quot;));t.localtime<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.xmlschema(&quot;1999-01-01T08:59:60+09:00&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.xmlschema(&quot;1999-01-01T00:59:60+01:00&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.xmlschema(&quot;1998-12-31T23:59:60+00:00&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.xmlschema(&quot;1998-12-31T22:59:60-01:00&quot;));t.utc<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t&nbsp;+=&nbsp;1&nbsp;if&nbsp;t.sec&nbsp;==&nbsp;60<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.xmlschema(&quot;1999-01-01T00:00:00Z&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.xmlschema(&quot;1999-01-01T00:00:00-00:00&quot;));t.localtime<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.xmlschema(&quot;1999-01-01T09:00:00+09:00&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.xmlschema(&quot;1999-01-01T01:00:00+01:00&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.xmlschema(&quot;1999-01-01T00:00:00+00:00&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(t,&nbsp;Time.xmlschema(&quot;1998-12-31T23:00:00-01:00&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;end<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_ruby_talk_152866<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t&nbsp;=&nbsp;Time::xmlschema('2005-08-30T22:48:00-07:00')<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(31,&nbsp;t.day)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(8,&nbsp;t.mon)<br />
&nbsp;&nbsp;&nbsp;&nbsp;end<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_parse_fraction<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(500000,&nbsp;Time.parse(&quot;2000-01-01T00:00:00.5+00:00&quot;).tv_usec)<br />
&nbsp;&nbsp;&nbsp;&nbsp;end<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;test_strptime<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assert_equal(Time.utc(2005,&nbsp;8,&nbsp;28,&nbsp;06,&nbsp;54,&nbsp;20),&nbsp;Time.strptime(&quot;28/Aug/2005:06:54:20&nbsp;+0000&quot;,&nbsp;&quot;%d/%b/%Y:%T&nbsp;%z&quot;))<br />
&nbsp;&nbsp;&nbsp;&nbsp;end<br />
&nbsp;&nbsp;end<br />
end<br />


<hr />
<div class="navigator"><span class="navigator">[<a href="index.html">MAIN</a>][<a href="refm539.html">INDEX</a>]&nbsp;&nbsp;&nbsp;[<a href="index.html">TOP</a>][<a href="index.html">UP</a>][<a href="refm526.html">&lt;-PREV</a>][<a href="refm528.html">NEXT-&gt;</a>]</span></div>

</body>
</html>
